
@{
    ViewData["Title"] = "کامنت ها";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@using Application.Comments.Dto
@model GetCommentForAdminDto
@addTagHelper *, LazZiya.TagHelpers
@using Admin.EndPoint.Helper
@{
    var alertClass = "";
    if (TempData["Message"] != null)
    {
        TempData["alertClass"] ??= "warning";
        alertClass = "alert-" + TempData["alertClass"];
    }

}
@section Stylesheets
{
    <link href="~/backend/plugins/select2/select2.min.css" rel="stylesheet" />
    <link href="~/lib/SweetAlert/sweetalert2.css" rel="stylesheet" />
}
<div class="col" id="alertPanel" style="display: @(alertClass != "" ? "" : "none");">
    <div class="alert @alertClass alert-dismissible">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        @if (TempData["Message"] != null)
        {
            @TempData["Message"]}

    </div>
</div>
<div class="row">
    <nav class="navbar navbar-expand-sm submenu-nav">
        <ul class="navbar-nav">

            <li class="nav-item">
                <a id="btn_edit_post" class="btn btn-default" asp-action="Edit" data-controller="Comment">
                    ویرایش <i class="nav-icon fa fa-edit"></i>
                </a>
            </li>
            <li class="nav-item">
                <form id="publish_form" asp-action="Publish">
                    <button type="submit" class="btn btn-default btn-change-state">
                        انتشار <i class="nav-icon fa fa-check"></i>
                    </button>
                </form>
            </li>
            @*<li class="nav-item">
                    <form id="Answer_form" asp-action="Answer">
                        <button type="submit" class="btn btn-default btn-change-state">
                            پاسخ <i class="nav-icon fas fa-comments"></i>
                        </button>
                    </form>
                </li>*@
            <li class="nav-item">
                <form id="trashed_form" asp-action="Trashed">
                    <button type="submit" class="btn btn-default btn-change-state">
                        سطل زباله <i class="nav-icon far fa-trash-alt"></i>
                    </button>
                </form>
            </li>

        </ul>
    </nav>
</div>
<div class="card-body table-responsive p-0">
    <div class="card">
        <div class="card-header">

            <div class="row">
                <div class="col-sm-4 col-xs-6">
                    <form asp-action="Index" method="get">
                        <div class="input-group">
                            <input type="text" name="q" class="form-control float-right" placeholder="جستجو">

                            <div class="input-group-append">
                                <span class="input-group-text"><i class="fa fa-search"></i></span>
                            </div>
                            <button type="submit" class="btn btn-primary">جستجو</button>
                        </div>
                    </form>
                </div>
                <div class="col-sm-4 col-xs-6">
                    <div class="form-group form-group-sm">
                        <form class="form-inline" asp-action="Index" method="post">
                            <button type="submit" name="search" value="clear" class="btn btn-default">
                                پاک کن
                            </button>
                        </form>

                    </div>
                </div>
            </div>

        </div>
        <table class="table table-hover">
            <thead>
                <tr>
                    <th><input type="checkbox" id="checkall" /></th>
                    <th>وضعیت</th>
                    <th>نام</th>
                    <th>دیدگاه</th>
                    <th>عنوان پست</th>
                    <th> پاسخ دیدگاه دیگری</th>
                    <th>پاسخ</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.comments != null)
                {
                    @foreach (var item in Model.comments)
                    {
                        <tr>

                            <td>
                                <input name="ids[]" type="checkbox" class="checkthis" value="@item.Id" />
                            </td>
                            <td>
                                @if (item.Status == 0)
                                {
                                    <span><i class="fa fa-times-circle" style="color: red;"></i></span> }
                                else if (item.Status == 1)
                                {
                                    <span><i class="fa fa-check-circle" style="color: green;"></i></span> }
                                else if (item.Status == 2)
                                {
                                    <span><i class="fas fa-archive" style="color: grey;"></i></span> }
                                else
                                {
                                    <span><i class="far fa-trash-alt" style="color: grey;"></i></span>}

                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.Name)
                            </td>
                            <td>
                                @item.Message.ToCuteTitleWithCounter(25)
                            </td>
                            <td>
                                @item.Post.Name<span class="badge badge-warning">@item.PostId</span>
                            </td>
                            <td>
                                @item.ParentTitle<span class="badge badge-info">@item.ParentId</span>
                            </td>
                            <td name="answer" data-postid="@item.PostId" data-commentid="@item.Id">
                                <i class="nav-icon fas fa-comments"></i>
                            </td>
                        </tr>
} }
                else
                {

                    <tr>
                        <td colspan="8"><span class="badge badge-info">هیچ دیگاهی درج نگردیده است</span></td>
                    </tr>
}
            </tbody>
        </table>
    </div>

</div>
<!-- /.card-body -->
<div class="card-footer">
    @{ if (Model != null && Model.PagerDto != null)
        {
            <paging page-no="@Model.PagerDto.PageNo"
                    page-size="@Model.PagerDto.PageSize"
                    total-records="@Model.PagerDto.TotalRecords"
                    show-prev-next="true"
                    show-total-pages="true"
                    show-total-records="true"
                    show-page-size-nav="true"
                    show-first-numbered-page="true"
                    show-last-numbered-page="true"
                    query-string-key-page-no="PageNo"
                    query-string-key-page-size="PageSize"
                    query-string-value="@@(Request.QueryString.Value)"
                    text-total-pages="صفحه"
                    text-total-records="رکورد"
                    text-first="&laquo;"
                    text-last="&raquo;"
                    text-previous="&lsaquo;"
                    text-next="&rsaquo;"
                    sr-text-first="اولین"
                    sr-text-last="آخرین"
                    sr-text-previous="قبلی"
                    sr-text-next="بعدی"
                    gap-size="2">
            </paging> } }

</div>

<div id="myModal" class="w3-modal">
    <div class="w3-modal-content">
        <header class="w3-container w3-teal" style="align-content:center;text-align:center">
            <span onclick="document.getElementById('myModal').style.display='none'"
                  class="w3-button w3-display-topright">&times;</span>
            <h2>پاسخ نظر کاربران</h2>
        </header>
        <form class="form" action="Answer" id="ModalForm">
            <div class="form-group mt-2 mb-2 ml-2">
                <input type="hidden" name="postid" />
                <input type="hidden" name="commentid" />
                <input type="text" class="form-control" id="answerModal" placeholder="پاسخ را وارد نمائید">

            </div>
            <button type="submit" id="btn110" class="btn btn-primary m-2">ثبت</button>
        </form>
        <footer class="w3-container w3-teal">
            <p>لطفا در ثبت پاسخ دقت فرمائید.</p>
        </footer>
    </div>
</div>
@section Scripts{
    <script src="~/backend/plugins/select2/select2.full.min.js"></script>
    <script src="~/backend/js/pages/content-list.js"></script>
    <link href="~/lib/W3/w3.css" rel="stylesheet" />
    <script src="~/lib/W3/w3.js"></script>
    <script src="~/lib/SweetAlert/sweetalert2.js"></script>
    @{ Html.RenderPartial("_AjaxJquery"); }
    <script>
        $("td[name|='answer']").on('click', function (e) {
            e.preventDefault();

            document.getElementById('myModal').style.display = 'block';

            var postID = $(this).data('postid');
            var commentID = $(this).data('commentid');
            $('#ModalForm input[name=postid]').val(postID);
            $('#ModalForm input[name=commentid]').val(commentID);
        });
        $("#btn110").on('click', function (e) {
            e.preventDefault();
            document.getElementById('myModal').style.display = 'none';
            var answer = $("form #answerModal").val();
            var postID= $('#ModalForm input[name=postid]').val();
            var commentID = $('#ModalForm input[name=commentid]').val();
            Swal.fire({
                title: `<span class="ml-2 bg-warning p-1 rounded-lg">آیا از مقادیر انتخاب شده خود مطمئن هستید؟</span>`,
                showDenyButton: true,
                showCancelButton: false,
                confirmButtonText: `ارسال`,
                denyButtonText: `انصراف`,
            }).then((result) => {
                /* Read more about isConfirmed, isDenied below */
                if (result.isConfirmed) {
                    var data = {Answer:answer, Postid:postID, Commentid:commentID};
                    $.ajax({
                        url: '@Url.Action("Answer", "Comment")',
                        contentType: 'application/x-www-form-urlencoded',
                        data: data,
                        type: "Post",
                        success: function (result) {
                            if (result.isSuccess) {
                                Swal.fire(result.message, '', 'success')
                                location.reload();
                            }
                            else {
                                Swal.fire({
                                    icon: 'info',
                                    title: result.message,
                                    showConfirmButton: false,
                                    timer: 3000
                                })
                            }

                        },
                        error: function () {

                            Swal.fire({
                                icon: 'info',
                                title: 'اطلاعات و مقادیر وارد شده نادرست می باشد دقت فرمائید!!',
                                showConfirmButton: false,
                                timer: 3000
                            })
                        }
                    });

                } else if (result.isDenied) {
                    Swal.fire('عمل  توسط شما لغو گردید', '', 'info')
                }
            })

        });
    </script>

}

